<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>TradeDynasty Registration (Google Sheet Live)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f3f7ff;
    padding: 20px;
  }
  h1 { text-align:center; color:#0066cc; }
  form {
    max-width: 500px;
    margin: 0 auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 8px #ccc;
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button {
    background-color: #007bff;
    color: white;
    cursor: pointer;
  }
  button:hover { background-color: #0056b3; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
  }
  th, td {
    border: 1px solid #999;
    padding: 8px;
    text-align: center;
  }
  th { background-color: #e0ecff; }
</style>
</head>
<body>

<h1>TradeDynasty Registration</h1>

<form id="registration-form">
  <input id="reg-id" placeholder="Registration ID (Auto)" readonly>
  <input id="name" placeholder="Name" required>
  <input id="district" placeholder="District" required>
  <input id="state" placeholder="State" required>
  <input id="mobile" placeholder="Mobile" required>
  <input id="date" type="date" required>
  <input id="amount" type="number" placeholder="Amount" required>
  <button id="submit-btn" type="submit">Save</button>
</form>

<h2 style="text-align:center;margin-top:40px;">Live Data (from Google Sheet)</h2>
<table id="data-table">
  <thead>
    <tr>
      <th>RegistrationID</th>
      <th>Name</th>
      <th>District</th>
      <th>State</th>
      <th>Mobile</th>
      <th>Date</th>
      <th>Amount</th>
      <th>Balance</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzGlOIQUTj6jvyRnaZRzU_v_RiOlabWQCxzAFlIBwlrReJdihEY5TSjysV3xnThOILKqA/exec";

// Auto-generate Registration ID
function generateRegId() {
  const id = Math.floor(100000 + Math.random() * 900000);
  document.getElementById("reg-id").value = id;
}

// Save data to Google Sheet
document.getElementById("registration-form").addEventListener("submit", async e => {
  e.preventDefault();
  const data = {
    action: "saveData",
    accounts: [{
      regId: document.getElementById("reg-id").value,
      name: document.getElementById("name").value,
      district: document.getElementById("district").value,
      state: document.getElementById("state").value,
      mobile: document.getElementById("mobile").value,
      date: document.getElementById("date").value,
      amount: parseFloat(document.getElementById("amount").value),
      balance: parseFloat(document.getElementById("amount").value),
      transactions: []
    }]
  };

  const btn = document.getElementById("submit-btn");
  btn.disabled = true;
  btn.textContent = "Saving...";

  try {
    const res = await fetch(GOOGLE_SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(data),
      headers: { "Content-Type": "application/json" }
    });
    const result = await res.json();
    if (result.success) {
      alert("✅ Data saved successfully!");
      loadData();
      document.getElementById("registration-form").reset();
      generateRegId();
    } else {
      alert("⚠️ Error: " + result.error);
    }
  } catch (err) {
    alert("❌ Connection error: " + err.message);
  }
  btn.disabled = false;
  btn.textContent = "Save";
});

// Load data from Google Sheet
async function loadData() {
  try {
    const res = await fetch(GOOGLE_SCRIPT_URL + "?action=getData&ts=" + Date.now());
    const data = await res.json();
    if (data.success) {
      const tbody = document.querySelector("#data-table tbody");
      tbody.innerHTML = "";
      data.accounts.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${row.RegistrationID || row.regId}</td>
          <td>${row.Name || row.name}</td>
          <td>${row.District || row.district}</td>
          <td>${row.State || row.state}</td>
          <td>${row.Mobile || row.mobile}</td>
          <td>${row.Date || row.date}</td>
          <td>${row.Amount || row.amount}</td>
          <td>${row.Balance || row.balance}</td>`;
        tbody.appendChild(tr);
      });
    }
  } catch (err) {
    console.log("Error loading data:", err);
  }
}

document.addEventListener("DOMContentLoaded", () => {
  generateRegId();
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("date").value = today;
  loadData();
});
</script>
</body>
</html>